<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>🎮 Ver.3 서바이벌 캣: 키키의 밤</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div id="gameContainer">
        <!-- 상단 UI: KIKI 현황 + 아이템/버프 현황 -->
        <div id="statusBar">
          <div class="infoPanel">
            <h3 class="info-title">KIKI 현황</h3>
            <div class="bar-group">
              <div class="bar-label" id="healthText">HP: 100/100</div>
              <div class="bar-bg"><div class="bar-fill" id="healthFill"></div></div>
            </div>
            <span id="timeDisplay" class="info-time">시간: 00:00</span>
            <span id="levelDisplay">레벨: 1</span>
            <div class="bar-group">
              <div class="bar-label" id="expText">XP: 0/100</div>
              <div class="bar-bg"><div class="bar-fill xp" id="expFill"></div></div>
            </div>
            <span id="scoreDisplay">점수: 0</span>
          </div>
          <div id="upgradeBuffPanel">
            <h3>내 업그레이드/버프</h3>
            <div id="upgradeInfo">
              <div>무기 강화: <span id="upgradeWeapon">0</span>회</div>
              <div>체력 증가: <span id="upgradeHp">0</span>회</div>
              <div>이동속도: <span id="upgradeSpeed">0</span>회</div>
            </div>
            <div id="buffInfo"></div>
          </div>
        </div>
        
        <!-- 게임 캔버스 -->
        <canvas id="gameCanvas" width="800" height="600"></canvas>

        <!-- 레벨업 UI (처음에는 숨김) -->
        <div id="levelUpModal" class="modal">
            <div class="modal-content">
                <h2>🎉 레벨업!</h2>
                <p>업그레이드를 선택하세요:</p>
                <div id="upgradeOptions">
                    <button class="upgrade-btn" data-upgrade="0">
                        <strong>무기 강화</strong>
                        <br>공격력 +20%
                    </button>
                    <button class="upgrade-btn" data-upgrade="1">
                        <strong>체력 증가</strong>
                        <br>최대 HP +30
                    </button>
                    <button class="upgrade-btn" data-upgrade="2">
                        <strong>이동 속도</strong>
                        <br>속도 +15%
                    </button>
                </div>
            </div>
        </div>

        <!-- 게임 오버 UI -->
        <div id="gameOverModal" class="modal">
            <div class="modal-content">
                <h2>💀 게임 오버</h2>
                <p id="survivalTime">생존 시간: 00:00</p>
                <p id="finalScore">최종 점수: 0</p>
                <button id="restartBtn">다시 시작</button>
            </div>
        </div>

        <!-- 게임 클리어 UI -->
        <div id="gameClearModal" class="modal">
            <div class="modal-content">
                <h2>🎊 축하합니다!</h2>
                <p>10분 생존에 성공했습니다!</p>
                <p id="clearTime">생존 시간: 10:00</p>
                <p id="clearScore">최종 점수: 0</p>
                <button id="continueBtn">계속 플레이</button>
                <button id="restartClearBtn">다시 시작</button>
            </div>
        </div>

        <!-- 조작 안내 -->
        <div id="controls">
            <p>🎮 조작: WASD로 이동 | 🎯 자동 공격</p>
        </div>

        <!-- 로딩/오류 표시 -->
        <div id="loading" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); z-index: 2000; color: white; font-size: 18px;">
            🎮 게임 로딩 중...
        </div>

        <!-- 모바일 전용 십자 방향키 -->
        <div id="mobileDPad">
          <button class="dpad-btn" id="dpad-up">▲</button>
          <button class="dpad-btn" id="dpad-left">◀</button>
          <button class="dpad-btn" id="dpad-right">▶</button>
          <button class="dpad-btn" id="dpad-down">▼</button>
        </div>
    </div>

    <script>
        // 오류 감지를 위한 전역 오류 핸들러
        window.addEventListener('error', function(e) {
            console.error('게임 오류:', e.error);
            document.getElementById('loading').innerHTML = '❌ 게임 로딩 실패: ' + e.message + '<br><button onclick="location.reload()">새로고침</button>';
        });

        // DOM이 완전히 로드된 후 스크립트 실행
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM 로딩 완료, 게임 스크립트 로딩 시작...');
            
            // 스크립트 동적 로딩
            const script = document.createElement('script');
            script.src = 'script.js';
            script.onload = function() {
                console.log('게임 스크립트 로딩 완료!');
                document.getElementById('loading').style.display = 'none';
            };
            script.onerror = function() {
                console.error('script.js 로딩 실패!');
                document.getElementById('loading').innerHTML = '❌ script.js 파일을 찾을 수 없습니다!<br><button onclick="location.reload()">새로고침</button>';
            };
            document.head.appendChild(script);
        });

        // 모바일 전용 십자 방향키 이벤트 추가
        const dpadButtons = document.querySelectorAll('.dpad-btn');
        dpadButtons.forEach(btn => {
            btn.addEventListener('mousedown', e => {
                e.preventDefault();
                console.log('mousedown', btn.id);
            });
            btn.addEventListener('mouseup', e => {
                e.preventDefault();
                console.log('mouseup', btn.id);
            });
        });
    </script>
</body>
</html> 